<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="lv" lang="lv">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Dagnija</title>
	<script type="text/javascript" src="jquery-3.1.0.js"></script>
</head>
<body onload="main()">

<audio controls id="music">
  <source src="mozart.mp3" type="audio/mpeg" >
Your browser does not support the audio element.
</audio>

<img src="Capture.PNG" id="sheet" />

<div id="playButton" class="button" onclick="play()">play</div>
<div id="pauseButton" class="button" onclick="pause()">pause</div>
<div id="stopButton" class="button" onclick="stop()">stop</div>
<div id="rewindButton" class="button" onclick="rewind()">rewind</div>
<div id="forwardButton" class="button" onclick="forward()">forward</div>





<script>

var offsetX = 500;
var splitTime
var musicTime = 20 // sec 

var animation;
var time;

var music;



function main(){
	console.log("Lapa ielādējās");
	music = document.getElementById("music");
	music.currentTime = 48
	
	splitTime = new Date().getTime()
	// window.requestAnimationFrame(loop);
}



function loop(){
	var sheet = document.getElementById("sheet");
	var date = new Date().getTime()
	
	var deltaTime = date-splitTime
	splitTime = date
		
	var move = (deltaTime/1000)*(sheet.width/musicTime)
	console.log(move)
	offsetX -= move;
	if(offsetX<=50 || music.currentTime>=60){
		pause()
		music.pause()
	} else {
		sheet.style.left = offsetX+"px"
		animation = window.requestAnimationFrame(loop)
	}
	


}

function play(){
	console.log("Spēlējam skaņdarbu");
	time = new Date().getTime();
	var sheet = document.getElementById("sheet");
	// offsetX -= 1;
	// sheet.style.left = offsetX+"px";
if (splitTime == 0) {
splitTime = new Date().getTime()
} 
music.play()
	animation = window.requestAnimationFrame(loop);
}

function pause(){
	console.log("Skaņdarbs ir nopauzēts");
	var sheet = document.getElementById("sheet");
	
	window.cancelAnimationFrame(animation)
	splitTime = 0
	}

function stop(){
	console.log("Skaņdarbs ir apturēts");
	var sheet = document.getElementById("sheet");
	offsetX = 500
	splitTime = 0
	sheet.style.left = offsetX + "px";
	console.log(animation);
	window.cancelAnimationFrame(animation);
}

function rewind(){
	console.log("Skaņdarbs ir attīts");
	var sheet = document.getElementById("sheet");
	offsetX = offsetX + 10;
	sheet.style.left = offsetX + "px";
}

function forward(){
	console.log("Skaņdarbs ir attīts");
	var sheet = document.getElementById("sheet");
	offsetX = offsetX - 10;
	sheet.style.left = offsetX + "px";
}




</script>




<style>
#sheet {
	position: absolute;
	left: 50px;
	top: 150px;
	border: 1px solid black;
}
.button {
	position: absolute;
	top: 70px;
	border: 1px solid blue;
	width: 50px;
	height: 50px;
}
#playButton {
	left: 50px;
}
#pauseButton {
	left: 120px;
}
#stopButton {
	left: 190px;	
}
#rewindButton {
	left: 260px;
}
#forwardButton {
	left: 330px;
}

</style>


</body>
</html>